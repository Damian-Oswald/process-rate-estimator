[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Documentation of the Process Rate Estimator R package PRE",
    "section": "",
    "text": "1 Preface\nThis site contains the documentation for the process rate estimator."
  },
  {
    "objectID": "introduction.html#background",
    "href": "introduction.html#background",
    "title": "2  Introduction",
    "section": "2.1 Background",
    "text": "2.1 Background\nDenitrification is the natural process by which nitrate (NO3-) in the soil are converted by bacteria into nitrous oxide (N2O) or pure nitrigen (N2). The latter is called total denitrification — the full process described in Equation 2.1 takes place.\n\\[\n\\ce{NO3^- -&gt;[\\text{Nitrate}][\\text{reductase}] NO2^- -&gt;[\\text{Nitrite}][\\text{reductase}] NO -&gt;[\\text{Nitrite oxide}][\\text{reductase}] N2O^- -&gt;[\\text{Nitrous oxide}][\\text{reductase}] N2}\n\\tag{2.1}\\]\nDenitrification occurs in conditions where oxygen is limited, such as waterlogged soils. It is part of the nitrogen cycle, where nitrogen is circulated between the atmosphere, organisms and the earth."
  },
  {
    "objectID": "introduction.html#the-data",
    "href": "introduction.html#the-data",
    "title": "2  Introduction",
    "section": "2.2 The data",
    "text": "2.2 The data\nThe study uses data collected from a mesocosm experiment – i.e. an outdoor experiment that examines the natural environment under controlled conditions. The experiment was set up as a randomized complete block design, with 4 varieties and 3 replicates, using 12 non-weighted lysimeters. A non-weighted lysimeter is a device to measure the amount of water that drains through soil, and to determine the types and amounts of dissolved nutrients or contaminants in the water. Each lysimeter had five sampling ports with soil moisture probes and custom-built pore gas sample, at depths of 7.5, 30, 60, 90 and 120 cm below soil surface.\n\\[4 \\times 3 \\times 5 \\times 161 = 9660 \\tag{2.2}\\]\nEquation 2.2 shows how many observations we should expect to have. In reality, some observations are missing.\n\n\n\n\n\n\n\n\nCode\nName\nDescription\n\n\n\n\ndate\nDate (YYYY-MM-DD)\n\n\n\ncolumn\nColumn\nOne out of twelve experimental units.\n\n\ndepth\nMeasurement depth\nDepth of the measurement, either 7.5, 30, 60, 90, or 120 cm.\n\n\nincrement\nHeight of a specific layer\n\n\n\nvariety\nWheat variety\nEither CH Claro, Monte Calme 268, Probus, or Zinal.\n\n\nmoisture\nSoil moisture\n\n\n\nN2O\nCorrected N2O conc.\n\n\n\nCO2\nCorrected CO2 conc.\n\n\n\nSP\nSite preference\nSite preference values for N2O\n\n\nd15Nbulk\n\n\n\n\nd15Nalpha\n\n\n\n\nd15Nbeta\n\n\n\n\nd18O\n\nRatio of stable isotopes oxygen-18 (18O) and oxygen-16 (16O)."
  },
  {
    "objectID": "data-preparation.html#formal-model-description",
    "href": "data-preparation.html#formal-model-description",
    "title": "3  Data preparation",
    "section": "3.1 Formal model description",
    "text": "3.1 Formal model description\n\n3.1.1 Model parameters\n\n\nTable 3.1: Overview of the parameters used in the model.\n\n\n\n\n\n\n\n\n\nSymbol\nCode\nName\nValue\nUnit\n\n\n\n\n\\(BD\\)\nBD\nBulk density (mass of the many particles of the material divided by the bulk volume)\n\\(1.686\\)\ng cm-3\n\n\n\\(\\theta_w\\)\ntheta_w\nSoil volumetric water content\n\n\n\n\n\\(\\theta_a\\)\ntheta_a\nAir-filled porosity\n\\(1-\\frac{\\theta_w}{\\theta_t}\\)\n\n\n\n\\(\\theta_t\\)\ntheta_t\nTotal soil porosity\n\\(1-\\frac{BD}{2.65}\\)\n\n\n\n\\(\\text T\\)\ntemperature\nSoil temperature\n\\(298\\)\nK\n\n\n\\(D_{\\text{s}}\\)\nD_s\nGas diffusion coefficient\nEquation 3.2\nm2s-1\n\n\n\\(D_{\\text{fw}}\\)\nD_fw\nDiffusivity of N2O in water\nEquation 3.4\n\n\n\n\\(D_{\\text{fa}}\\)\nD_fa\nDiffusivity of N2O in air\nEquation 3.5\n\n\n\n\\(D_{\\text{fa,NTP}}\\)\n\nFree air diffusion coefficient under standard conditions\nEquation 3.5\n\n\n\n\\(n\\)\nn\nEmpirical parameter (1)\n1.81\n\n\n\n\\(H\\)\nH\nDimensionless Henry’s solubility constant\nEquation 3.3\n\n\n\n\\(\\rho\\)\nrho\nGas density of N2O\n\\(1.26 \\times 10^6\\)\nmg m-3\n\n\n\n\nThe diffusion fluxes between soil increments are described by Frick’s law (Equation 3.1).\n\\[F_{\\text{calc}} = \\frac{dC}{dZ} D_{\\text s} \\rho \\tag{3.1}\\]\nHere, \\(D_s\\) is the gas diffusion coefficient, \\(\\rho\\) is the gas density of N2O, and \\(\\frac{dC}{dZ}\\) is the N2O concentration gradient from lower to upper depth. The fluxes are calculated based on N2O concentration gradients between 105-135 cm, 75-105 cm, 45-75 cm, 15-45 cm, and 0-15 cm depth layers, and ambient air above the soil surface.\n\\(\\theta_w\\) is the soil volumetric water content, \\(\\theta_a\\) the air-filled porosity, and \\(\\theta_T\\) is the total soil porosity.\nThe gas diffusion coefficient \\(D_{\\text s}\\) was calculated according Equation 3.2 as established by Millington and Quirk in 1961 (2).\n\\[D_{\\text s} = \\left( \\frac{\\theta_w^{\\frac{10}{3}} + D_{\\text fw}}{H} + \\theta_a^{\\frac{10}{3}} \\times D_{\\text fa} \\right) \\times \\theta_T^{-2} \\tag{3.2}\\]\nHere, \\(H\\) represents a dimensionless form of Henry’s solubility constant (\\(H'\\)) for N2O in water at a given temperature. The constant \\(H\\) for N2O is calculated as follows:\n\\[H = \\frac{8.5470 \\times 10^5 \\times \\exp \\frac{-2284}{\\text T}}{\\text R \\times \\text T} \\tag{3.3}\\]\nHere, \\(\\text R\\) is the gas constant, and \\(\\text T\\) is the temperature (\\(\\text T = 298 \\; \\text K\\)).\n\\(D_{\\text{fw}}\\) was calculated according to Equation 3.4 as documented by Versteeg and Van Swaaij (1988) (3).\n\\[D_{\\text{fw}} = 5.07 \\times 10^{-6} \\times \\exp \\frac{-2371}{\\text T} \\tag{3.4}\\]\n\\[D_{\\text{fa}} = D_{\\text{fa, NTP}} \\times \\left( \\frac{\\text T}{273.15} \\right)^n \\times \\left( \\frac{101'325}{\\text P} \\right) \\tag{3.5}\\]\n\n\n3.1.2 Smoothing curves\nThe N2O concentration, site preference as well as \\(\\delta\\)18O are estimated as a function of time for every depth and every column, separately. To achieve this function approximation, Kernel Regression as implemented in npreg is used (4). Besides choosing a Kernel, the model only requires a single hyperparameter, i.e. the bandwidth (bws), which facilitates the hyperparameter tuning.\n\n\n\nFigure 3.1: Animated explanation on two examplary subsets of the data. On the left, there is a very high sinal to noise ratio, thus the optimal bandwith hyperparameter will be smaller than on the right.\n\n\nThe bandwidth hyperparameter is individually tuned using 3-fold 10 times repeated cross-validation for every combination of column and depth and variable1, respectively.\n\n\n\nFigure 3.2: Visualization of the optimal hyperparameter size by depth and column for the site N2O-N concentration\n\n\n\n\n\nFigure 3.3: Visualization of the optimal hyperparameter size by depth and column for the site preference.\n\n\n\n\n\nFigure 3.4: Visualization of the optimal hyperparameter size by depth and column for the \\(\\delta\\)18O concentration.\n\n\n\n\n3.1.3 State function set\nThe process rate estimator includes three-state functions, describing the change in N2O concentrations over time. The change in N2O concentrations in each depth increment over time \\(\\frac{d}{dt}[\\ce{N2O}]\\) depends on the flux of N2O entering the depth increment from the top or the bottom through diffusion (\\(F_{top,in}\\) and \\(F_{bot,in}\\), respectively), the flux of N2O leaving the depth increment through diffusion (\\(F_{out}\\)), the rate of N2O produced through nitrification (N2Onit), the rate of N2O produced through denitrification (N2Oden), and the rate of N2O reduced to N2 (N2Ored).\n\\[\\frac{\\Delta[\\ce{N2O}]}{\\Delta t} = F_{top} + F_{bottom}  + \\ce{N2O}_{\\text{nitrification}} + \\ce{N2O}_{\\text{denitrification}} + \\ce{N2O}_{\\text{reduction}} \\tag{3.6}\\]\n\\[\\frac{\\Delta \\text{SP}}{\\Delta t} = F_{t,i}(\\text{SP}_{t,i} - \\eta_{SP,dif} - \\text{SP}_0) + F_{b,i}(\\text{SP}_{b,i}) ... \\tag{3.7}\\]\n\n\n3.1.4 Numerical differentiation\nOne common way to numerically approximate the derivative of a function \\(f\\) at a point \\(t\\) is through the central difference method. This method computes the average rate of change over a small interval around the point of interest.\n\\[\\frac{df}{dt} \\approx \\frac{f(t + h) - f(t - h)}{2h} \\tag{3.8}\\]\nHere, \\(h\\) is a small positive number known as the step size. The notations \\(f(t + h)\\) and \\(f(t - h)\\) represent the function values at \\(t + h\\) and \\(t - h\\), respectively. The smaller h is, the more accurate the approximation should be. However, if h is too small, then round-off errors from computer arithmetic can become significant. So, an appropriate balance must be struck. The central difference method is implemented as the fderiv function in the pracma R package.\n\n\n\n\n1. Massman, W. A review of the molecular diffusivities of H2O, CO2, CH4, CO, O3, SO2, NH3, N2O, NO, and NO2 in air, O2 and N2 near STP. Atmospheric environment 32, 1111–1127 (1998).\n\n\n2. Millington, R. & Quirk, J. Permeability of porous solids. Transactions of the Faraday Society 57, 1200–1207 (1961).\n\n\n3. Versteeg, G. F. & Van Swaaij, W. P. Solubility and diffusivity of acid gases (carbon dioxide, nitrous oxide) in aqueous alkanolamine solutions. Journal of Chemical & Engineering Data 33, 29–34 (1988).\n\n\n4. Hayfield, T. & Racine, J. S. Nonparametric econometrics: The np package. Journal of Statistical Software 27, 1–32 (2008)."
  },
  {
    "objectID": "data-preparation.html#footnotes",
    "href": "data-preparation.html#footnotes",
    "title": "3  Data preparation",
    "section": "",
    "text": "I.e. the three variables N2O concentration, site preference and \\(\\delta\\)18O.↩︎"
  },
  {
    "objectID": "running-the-model.html#install-the-r-package-pre",
    "href": "running-the-model.html#install-the-r-package-pre",
    "title": "4  Running the process rate estimator",
    "section": "4.1 Install the R package PRE",
    "text": "4.1 Install the R package PRE\nYou can directly install this R package from GitHub. The package itself already contains all data and parameters necessary to run the process rate estimator.\n\ninstall.packages(\"remotes\")\nremotes::install_github(\"https://github.com/Damian-Oswald/PRE\")\n\nOnce installed, add the package to the search path.\n\nlibrary(PRE)"
  },
  {
    "objectID": "running-the-model.html#prepare-the-data",
    "href": "running-the-model.html#prepare-the-data",
    "title": "4  Running the process rate estimator",
    "section": "4.2 Prepare the data",
    "text": "4.2 Prepare the data\nIn a first step, we can calculate the N2O-N from the original measurements.\n\noriginal &lt;- getN2ON(data = measurements, parameters = parameters)\n\nNext, the data are interpolated. This process uses kernel regression to interpolate between the measured values of N2O-N, SP and d18O.\n\ndata &lt;- getMissing(data = data, hyperparameters = hyperparameters)\n\nWith all of these steps done, we can calculate the Fluxes according to equations 1, 2, 3.\n\ndata &lt;- calculateFluxes(data = data, parameters = parameters)\n\nNow, everything is ready to run the PRE."
  },
  {
    "objectID": "running-the-model.html#running-the-process-rate-estimator",
    "href": "running-the-model.html#running-the-process-rate-estimator",
    "title": "4  Running the process rate estimator",
    "section": "4.3 Running the process rate estimator",
    "text": "4.3 Running the process rate estimator\n\n# run the solver once\nx &lt;- PRE(data = data, column = 1, depth = 7.5, date = \"2016-01-01\", n = 200)\n\n# print out information\nprint(x)\n\n# plot\nplot(x)\n\n# pairs panel\npairs(x)"
  },
  {
    "objectID": "results.html",
    "href": "results.html",
    "title": "5  Results",
    "section": "",
    "text": "TODO: Make a panel tabset to go through all results.\n\n\nColumn 1Column 2\n\n\n\nDepth = 7.5Depth = 30Depth = 60Depth = 90Depth = 120\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDepth = 7.5Depth = 30Depth = 60Depth = 90Depth = 120"
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "1. Hayfield, T. & Racine, J. S. Nonparametric econometrics:\nThe np package. Journal of Statistical Software\n27, 1–32 (2008).\n\n\n2. Massman, W. A review of the molecular\ndiffusivities of H2O, CO2, CH4, CO, O3, SO2, NH3, N2O, NO, and NO2 in\nair, O2 and N2 near STP. Atmospheric environment\n32, 1111–1127 (1998).\n\n\n3. Versteeg, G. F. & Van Swaaij, W. P.\nSolubility and diffusivity of acid gases (carbon dioxide, nitrous oxide)\nin aqueous alkanolamine solutions. Journal of Chemical &\nEngineering Data 33, 29–34 (1988).\n\n\n4. Millington, R. & Quirk, J. Permeability of\nporous solids. Transactions of the Faraday Society\n57, 1200–1207 (1961)."
  }
]